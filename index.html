<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Mi Stock App</title>
  <style>
    body {
        font-family: Arial, sans-serif;
        max-width: 700px;
        margin: 20px auto;
        padding: 10px;
    }
    h2 {
        margin-top: 40px;
    }
    input, button {
        padding: 6px;
        margin: 5px 0;
    }
    .product-card {
        border: 1px solid #ccc;
        padding: 10px;
        margin: 8px 0;
        border-radius: 5px;
    }
  </style>
</head>
<body>

  <h1>Mi Stock App</h1>

  <h2>Agregar producto</h2>
  <div>
      <input id="name" placeholder="Nombre" /> <br>
      <input id="sku" placeholder="SKU" /> <br>
      <input id="stock" type="number" placeholder="Stock inicial" /> <br>
      <input id="min_stock" type="number" placeholder="Stock mínimo" /> <br>
      <input id="price" type="number" placeholder="Precio" /> <br>

      <button id="btnAdd">Agregar</button>
  </div>

  <h2>Productos</h2>
  <button id="btnLoad">Recargar lista</button>
  <div id="products"></div>

<script>
const URL = "https://script.google.com/macros/s/AKfycbyggNBrQoYly1zo4pAS1wTz3MrxWmahfYSKlg0biK7FIxYU62h-1Ze5XmIF4HVCgtYc/exec";

/* ===== Helper para POST ===== */
async function post(action, data = {}) {
    const form = new FormData();
    form.append("action", action);

    for (const key in data) {
        form.append(key, data[key]);
    }

    const res = await fetch(URL, {
        method: "POST",
        body: form
    });

    return res.json();
}

/* ===== Agregar producto ===== */
document.getElementById("btnAdd").onclick = async () => {
    const data = {
        name: document.getElementById("name").value,
        sku: document.getElementById("sku").value,
        stock: document.getElementById("stock").value,
        min_stock: document.getElementById("min_stock").value,
        price: document.getElementById("price").value
    };

    const r = await post("addProduct", data);
    alert("Producto agregado ✔️ ID: " + r.id);

    loadProducts();
};

/* ===== Cargar productos ===== */
async function loadProducts() {
    const productsDiv = document.getElementById("products");
    productsDiv.innerHTML = "<em>Cargando...</em>";

    const data = await post("getProducts");

    productsDiv.innerHTML = "";

    data.forEach(p => {
        const div = document.createElement("div");
        div.className = "product-card";

        div.innerHTML = `
            <strong>${p.name}</strong> (${p.sku})<br>
            Stock: ${p.stock} <br>
            Precio: $${p.price} <br>
            ID: <small>${p.id}</small>
        `;

        productsDiv.appendChild(div);
    });
}

document.getElementById("btnLoad").onclick = loadProducts;

// Cargar al abrir
loadProducts();
</script>

</body>
</html>
